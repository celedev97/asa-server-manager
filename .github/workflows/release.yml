name: Release

on:
  workflow_call:
    inputs:
      version:
        required: true
        type: string

permissions:
  contents: write

jobs:
  release:
    if: github.event.workflow_run.conclusion == 'success' && startsWith(github.event.workflow_run.head_branch, 'refs/tags/v')
    runs-on: windows-latest

    steps:
    - uses: actions/checkout@v3

    # download artifact asa_sm_jar
    - uses: actions/download-artifact@v3
      with:
        name: asa_sm_jar
        path: target

    - name: Building the installer
      run: |
        cd innosetup
        "%programfiles(x86)%\Inno Setup 6\iscc.exe" "script.iss"
      shell: cmd

    - uses: ncipollo/release-action@v1.13.0
      with:
        name: ${{ inputs.version }}
        tag: ${{ inputs.version }}
        artifacts: "innosetup/Output/*.exe"
        prerelease: true
        generateReleaseNotes: true
